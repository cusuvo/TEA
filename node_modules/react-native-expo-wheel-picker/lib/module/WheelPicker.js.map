{"version":3,"sources":["WheelPicker.tsx"],"names":["React","useCallback","useRef","useMemo","useEffect","View","FlatList","Dimensions","Platform","Animated","useSharedValue","useAnimatedScrollHandler","Item","usePresenter","Styles","isFunction","itemHeight","AnimatedFlatList","createAnimatedComponent","width","get","WheelPicker","props","scrollView","offset","scrollHandler","e","value","contentOffset","y","items","propItems","numberOfVisibleRows","onChange","valueAttribute","labelAttribute","defaultIndex","height","currentIndex","onValueChange","initialValue","renderItem","item","index","label","snapToOffsets","Array","length","fill","map","_","separators","position","justifyContent","contentContainerStyle","alignItems","paddingVertical","onMomentumScrollEndAndroid","OS","setTimeout","scrollToOffset","animated","current","getNode","memo"],"mappings":"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","sourcesContent":["// src/WheelPicker.tsx\nimport React, { useCallback, useRef, useMemo, useEffect } from 'react';\nimport { View, FlatList, Dimensions, ViewStyle, Platform } from 'react-native';\nimport Animated, {\n  useSharedValue,\n  useAnimatedScrollHandler,\n} from 'react-native-reanimated';\nimport Item from './Item';\nimport usePresenter from './usePresenter';\nimport Styles from './index.style';\nimport isFunction from 'lodash/isFunction';\nimport { itemHeight } from './constant';\n\nconst AnimatedFlatList = Animated.createAnimatedComponent(FlatList);\n\nconst { width } = Dimensions.get('window');\n\ninterface IWheelPickerProps {\n  items: any[];\n  onChange: (index: number) => void;\n  numberOfVisibleRows?: number;\n  value: any;\n  labelAttribute?: string;\n  valueAttribute?: string;\n}\n\nfunction WheelPicker(props: IWheelPickerProps) {\n  const scrollView = useRef<Animated.ScrollView>();\n  const offset = useSharedValue(0);\n  const scrollHandler = useAnimatedScrollHandler((e) => {\n    offset.value = e.contentOffset.y;\n  });\n\n  const {\n    items: propItems,\n    numberOfVisibleRows = 5,\n    value,\n    onChange = () => {},\n    valueAttribute = 'value',\n    labelAttribute = 'name',\n  } = props;\n\n  const { items, defaultIndex, height, currentIndex, onValueChange } =\n    usePresenter({\n      initialValue: value,\n      items: propItems,\n      valueAttribute,\n      labelAttribute,\n      numberOfVisibleRows,\n    });\n\n  const renderItem = useCallback(\n    ({ item, index }) => (\n      <Item\n        index={index}\n        offset={offset}\n        itemHeight={itemHeight}\n        label={item.label}\n      />\n    ),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  useEffect(() => {\n    if (currentIndex !== defaultIndex) onChange(currentIndex);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentIndex]);\n\n  const snapToOffsets = useMemo(\n    () =>\n      Array(items.length)\n        .fill(0)\n        .map((_, index) => index * 46),\n    [items]\n  );\n\n  const separators = useMemo(() => {\n    return (\n      <View\n        // eslint-disable-next-line react-native/no-inline-styles\n        style={{\n          position: 'absolute',\n          justifyContent: 'center',\n          width,\n          height,\n        }}\n        pointerEvents=\"none\"\n      >\n        <View style={Styles.separators} />\n      </View>\n    );\n  }, [height]);\n\n  const contentContainerStyle: ViewStyle = useMemo(\n    () => ({\n      width,\n      alignItems: 'center',\n      paddingVertical: height / 2 - itemHeight / 2,\n    }),\n    [height]\n  );\n\n  const onMomentumScrollEndAndroid = (index: number) => {\n    if (Platform.OS === 'android' && currentIndex !== index) {\n    }\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      // console.log(defaultIndex);\n      onMomentumScrollEndAndroid(defaultIndex);\n      scrollToOffset(defaultIndex, true);\n    }, 100);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultIndex]);\n\n  const scrollToOffset = (index: number, animated: boolean) => {\n    if (isFunction((scrollView.current as any)?.scrollToOffset)) {\n      (scrollView.current as any)?.scrollToOffset({\n        offset: index * itemHeight,\n        animated,\n      });\n    } else {\n      (scrollView.current?.getNode() as any)?.scrollToOffset({\n        offset: index * itemHeight,\n        animated,\n      });\n    }\n  };\n\n  return (\n    <View style={{ height }}>\n      <AnimatedFlatList\n        // @ts-ignore\n        ref={scrollView}\n        height={height}\n        data={items}\n        showsVerticalScrollIndicator={false}\n        scrollEventThrottle={100}\n        initialNumToRender={numberOfVisibleRows}\n        onScroll={scrollHandler}\n        pagingEnabled\n        renderItem={renderItem}\n        snapToOffsets={snapToOffsets}\n        keyExtractor={(_, index) => `Item_${index}`}\n        contentContainerStyle={contentContainerStyle}\n        snapToInterval={itemHeight}\n        decelerationRate={0.99}\n        onMomentumScrollEnd={onValueChange}\n      />\n      {separators}\n    </View>\n  );\n}\n\nexport default React.memo(WheelPicker);\n"]}