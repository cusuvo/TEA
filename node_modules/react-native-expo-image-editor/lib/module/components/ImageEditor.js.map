{"version":3,"sources":["ImageEditor.tsx"],"names":["React","useEffect","useState","StyleSheet","SafeAreaView","ImageBackground","Dimensions","manipulateAsync","Controller","Manipulator","Provider","getImageLayout","getImageSize","styles","create","container","backgroundColor","flex","previewArea","modHeader","flexDirection","height","width","get","ImageEditor","props","source","onBack","onDone","saveOptions","uri","setUri","imageSize","setImageSize","handleUpdate","croppedImage","layout","handleDone","compressImage","imageUri","imageWidth","imageHeight","resize"],"mappings":"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","sourcesContent":["// src/component/ImageEditor.tsx\nimport React, { useEffect, useState } from 'react';\nimport {\n  StyleSheet,\n  SafeAreaView,\n  ImageBackground,\n  Dimensions,\n} from 'react-native';\nimport { SaveOptions, manipulateAsync } from 'expo-image-manipulator';\nimport Controller from './Controller';\nimport Manipulator from './Manipulator';\nimport { Provider } from './Provider';\nimport { getImageLayout, getImageSize } from './utils';\n\nconst styles = StyleSheet.create({\n  container: {\n    backgroundColor: '#000',\n    flex: 1,\n  },\n  previewArea: {\n    backgroundColor: 'rgb(22, 22, 22)',\n    flex: 1,\n  },\n  modHeader: {\n    flexDirection: 'row',\n    flex: 1,\n    height: 120,\n  },\n});\n\ninterface ICropperContainerProps {\n  source: { uri: string };\n  onBack: () => void;\n  onDone: (newImage: any) => void;\n  saveOptions: SaveOptions;\n}\n\nconst { width, height } = Dimensions.get('window');\n\nexport default function ImageEditor(\n  props: ICropperContainerProps\n): JSX.Element {\n  const { source, onBack, onDone, saveOptions } = props;\n  const [uri, setUri] = useState(source.uri);\n  const [imageSize, setImageSize] = useState({ width: 0, height: 0 });\n\n  const handleUpdate = (croppedImage: any) => {\n    setUri(croppedImage.uri);\n  };\n\n  useEffect(() => {\n    (async () => {\n      const layout = await getImageLayout(uri, width, height - 240);\n      setImageSize(layout);\n    })();\n  }, [uri]);\n\n  const handleDone = async () => {\n    onDone(await compressImage(uri));\n  };\n\n  const compressImage = async (imageUri: string) => {\n    const { width: imageWidth, height: imageHeight } = await getImageSize(\n      imageUri\n    );\n    return manipulateAsync(\n      imageUri,\n      [{ resize: { width: imageWidth, height: imageHeight } }],\n      saveOptions\n    );\n  };\n\n  return (\n    <Provider uri={uri}>\n      <SafeAreaView style={styles.container}>\n        <Controller onBack={onBack} onDone={handleDone}>\n          <ImageBackground\n            source={{ uri }}\n            style={{\n              width: imageSize.width,\n              height: imageSize.height,\n            }}\n          />\n        </Controller>\n        <Manipulator uri={uri} onUpdate={handleUpdate} />\n      </SafeAreaView>\n    </Provider>\n  );\n}\n"]}